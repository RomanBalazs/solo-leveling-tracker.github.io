<!doctype html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b0f17" />
  <base href="./">
  <title>System Tracker 2026</title>
  <link rel="icon" type="image/png" href="./favicon.png" />
  <link rel="stylesheet" href="./style.css" />
  <link rel="manifest" href="./manifest.webmanifest" />
</head>
<body>
  <header class="topbar">
    <div class="topbarRow">
      <div class="brand">
        <div class="badge systemLogo" title="SYSTEM">
          <img class="systemLogoImg" src="./smilestatue.png" alt="System" />
        </div>
        <div class="title">
          <div class="h1">System Tracker 2026</div>
          <div class="h2">Profil • Küldetések • Beosztás • Étkezés</div>
        </div>
      </div>

      <div class="topWidgets" aria-label="Idő és időjárás">
        <div class="pill" id="clockPill">--:--</div>
        <div class="pill" id="weatherPill">Időjárás: –</div>
        <div class="cityWidget">
          <select id="citySelect" aria-label="Város">
            <option value="Budapest">Budapest</option>
            <option value="Tatabánya">Tatabánya</option>
          </select>
          <button class="btn small" id="saveCityBtn">Mentés</button>
        </div>
      </div>
    </div>

    <nav class="tabs" aria-label="Fő menü">
      <button class="tab active" data-tab="profile">Profil</button>
      <button class="tab" data-tab="quests">Küldetések</button>
      <button class="tab" data-tab="schedule">Beosztás</button>
      <button class="tab" data-tab="meal">Étkezés</button>
    </nav>
  </header>

  <main class="container">
    <section id="view-profile" class="view active">
      <div class="grid">
        <div class="card">
          <div class="cardTitle">Profil</div>

          <div class="avatarRow">
            <div class="avatarBox">
              <img id="avatarImg" alt="Profilkép" />
            </div>
            <div class="avatarActions">
              <label class="btn ghost" style="display:inline-flex; align-items:center; gap:8px; cursor:pointer">
                Profilkép feltöltése (max 2 MB)
                <input type="file" id="avatarInput" accept="image/*" style="display:none">
              </label>
              <div class="hint">A profilkép csak helyben tárolódik (localStorage).</div>
            </div>
          </div>

          <div class="row">
            <div class="pill" id="rankPill">Rank: –</div>
            <div class="pill" id="levelPill">Lv –</div>
            <div class="pill" id="pointsPill">Pont: –</div>
          </div>
          <div class="row">
            <div class="pill" id="streakPill">Streak: –</div>
            <div class="pill" id="tokenPill">Token: –</div>
            <div class="pill" id="cratePill">Crate: –</div>
            <div class="pill" id="titlePill">Cím: –</div>
            <div class="pill" id="pinnedBadges">Kitűzve: –</div>
          </div>
          <div class="row">
            <div class="pill" id="penaltyMonthsPill">Büntető hónapok: –</div>
            <div class="pill" id="manualEditPill">Manual edit: –</div>
            <div class="pill" id="perkPill">Perk pont: –</div>
          </div>

          <div class="progress">
            <div class="progressLabel">
              <span>EXP</span>
              <span id="expLabel">–</span>
            </div>
            <div class="bar">
              <div class="fill" id="expFill" style="width:0%"></div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="cardTitle">Perk választás</div>
          <div class="row">
            <label class="field" style="min-width:280px; margin:0">
              <span>Elérhető perk</span>
              <select id="perkSelect"></select>
            </label>
            <button class="btn" id="choosePerkBtn">Perk kiválasztása</button>
          </div>
          <div class="hint" id="perkHint">Szintenként kapsz 1 perk pontot. A perk végleges.</div>

          <div class="divider"></div>

          <div class="cardTitle">Stat pontok</div>
          <div class="stats">
            <div class="stat">
              <div class="statName">STR</div>
              <div class="statVal" id="statSTR">0</div>
              <button class="btn small" data-stat="STR">+1</button>
            </div>
            <div class="stat">
              <div class="statName">END</div>
              <div class="statVal" id="statEND">0</div>
              <button class="btn small" data-stat="END">+1</button>
            </div>
            <div class="stat">
              <div class="statName">REC</div>
              <div class="statVal" id="statREC">0</div>
              <button class="btn small" data-stat="REC">+1</button>
            </div>
            <div class="stat">
              <div class="statName">DISC</div>
              <div class="statVal" id="statDISC">0</div>
              <button class="btn small" data-stat="DISC">+1</button>
            </div>
          </div>

          <div class="hint">Szintlépéskor kapsz pontot, amit itt el tudsz költeni.</div>
        </div>

        <div class="card">
          <div class="cardTitle">Beállítások</div>

          <div class="formGrid">
            <label class="field">
              <span>Kezdő súly (kg)</span>
              <input type="number" step="0.1" id="setStartWeight">
            </label>
            <label class="field">
              <span>Célsúly (kg)</span>
              <input type="number" step="0.1" id="setGoalWeight">
            </label>
            <label class="field">
              <span>Aktuális súly (kg)</span>
              <input type="number" step="0.1" id="setCurrentWeight">
            </label>
            <label class="field">
              <span>Edzés szint (1–5)</span>
              <select id="trainingLevel">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
              </select>
            </label>
            <label class="field">
              <span>Anti-cheat (lezárt nap feloldása okkal)</span>
              <select id="antiCheat">
                <option value="on">Bekapcsolva</option>
                <option value="off">Kikapcsolva</option>
              </select>
            </label>
            <label class="field">
              <span>Napi emlékeztető (20:00)</span>
              <select id="notifDaily">
                <option value="off">Kikapcsolva</option>
                <option value="on">Bekapcsolva</option>
              </select>
            </label>
          </div>

          <div class="row">
            <button class="btn" id="saveSettings">Mentés</button>
            <button class="btn ghost" id="resetLocal">Helyi adatok törlése</button>
          </div>
          <div class="row" style="margin-top:10px">
            <button class="btn" id="exportDataBtn">Export (JSON)</button>
            <label class="btn ghost" style="display:inline-flex; align-items:center; gap:8px; cursor:pointer">
              Import (JSON)
              <input type="file" id="importFile" accept="application/json" style="display:none">
            </label>
            <button class="btn ghost" id="exportHunterIdBtn">Hunter ID (PNG)</button>
            <button class="btn" id="openCrateBtn">Crate nyitás</button>
          </div>

          <div class="divider"></div>
          <div class="cardTitle">Excel import (helyi adat)</div>
          <div class="row">
            <label class="btn ghost" style="display:inline-flex; align-items:center; gap:8px; cursor:pointer">
              Excel import (.xlsx)
              <input type="file" id="excelImport" accept=".xlsx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" style="display:none">
            </label>
            <button class="btn ghost" id="clearExcelOverrideBtn" title="Visszaáll a repo JSON adatokra">Excel override törlése</button>
          </div>
          <div class="hint">Az Excel-ből beolvasott adatok csak helyben mentődnek, nem kerülnek GitHubra.</div>

          <div class="divider"></div>
          <div class="cardTitle">Backup (1 kattintás)</div>
          <div class="row">
            <button class="btn" id="makeBackupBtn">Backup string generálás</button>
            <button class="btn ghost" id="restoreBackupBtn">Visszaállítás</button>
          </div>
          <label class="field" style="margin-top:10px">
            <span>Backup string (másold Notes-ba)</span>
            <textarea id="backupText" rows="4" placeholder="Itt jelenik meg (vagy ide illeszd be restore-hoz)"></textarea>
          </label>

          <div class="divider"></div>
          <div class="cardTitle">Edzés terv (skálázva)</div>
          <div id="trainingCards" class="stack"></div>
          <div class="hint" id="scalingHint">–</div>
          <div class="divider"></div>
          <div class="cardTitle">Edzés jelölések (teljes terv)</div>
          <div id="trainingTable" class="list"></div>
        </div>

        <div class="card">
          <div class="cardTitle">Mérés</div>
          <div class="formGrid">
            <label class="field">
              <span>Dátum</span>
              <input type="date" id="mDate">
            </label>
            <label class="field">
              <span>Súly (kg)</span>
              <input type="number" step="0.1" id="mWeight">
            </label>
            <label class="field">
              <span>Derék (cm)</span>
              <input type="number" step="0.1" id="mWaist">
            </label>
            <label class="field">
              <span>Megjegyzés</span>
              <input type="text" id="mNote" placeholder="opcionális">
            </label>
          </div>
          <div class="row">
            <button class="btn" id="addMeasurement">Hozzáadás</button>
          </div>

          <div class="divider"></div>
          <div class="cardTitle">Mérések listája</div>
          <div id="measureList" class="list"></div>
        </div>

        <div class="card">
          <div class="cardTitle">Összegzés</div>
          <div id="summaryBox" class="summary"></div>
          <div class="divider"></div>
          <div class="cardTitle">Trend (30 nap)</div>
          <canvas id="trendCanvas" width="900" height="260" style="width:100%; height:260px; border:1px solid var(--line); border-radius: var(--radius2); background: rgba(0,0,0,.15)"></canvas>
          <div class="hint">Lépés / Alvás / Súly helyi adatokból.</div>
        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <div class="row space">
          <div class="cardTitle">Inventory</div>
          <div class="hint">Badge-ek ritkasággal + collection setek.</div>
        </div>
        <div class="divider"></div>
        <div class="row" style="margin-bottom:10px">
          <div class="pill" id="badgeSlots">Slotok: –</div>
          <div class="pill" id="collectionPill">Collections: –</div>
        </div>
        <div id="inventoryList" class="list"></div>
      </div>

    </section>

    <section id="view-quests" class="view">
      <div class="card">
        <div class="row space">
          <div>
            <div class="cardTitle">Küldetések</div>
            <div class="hint">
              Heti bontás. Az aktív napot tudod pipálni és lezárni. A Havi Boss és a Büntető küldetés extra motivációként jelenik meg.
            </div>
          </div>
          <div class="row">
            <button class="btn ghost" id="focusToggleBtn">Focus Mode</button>
            <div class="pill" id="todayPill">Ma: –</div>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <label class="field" style="min-width:220px">
            <span>Aktív hónap</span>
            <input type="month" id="activeMonth">
          </label>
          <label class="field" style="min-width:220px">
            <span>Aktív nap (módosítható)</span>
            <input type="date" id="activeDate">
          </label>
          <button class="btn" id="lockDayBtn">Nap mentése + lezárás</button>
          <button class="btn ghost" id="unlockDayBtn" title="Csak ha tévedésből zártad le">Feloldás</button>
        </div>

        <div class="divider"></div>

        <div id="penaltyCard" class="card danger" style="margin:0 0 12px 0; display:none">
          <div class="row space">
            <div>
              <div class="cardTitle">⚠ Büntető küldetés</div>
              <div class="hint" id="penaltyHint">–</div>
            </div>
            <div class="pill" id="penaltyTimerPill">–</div>
          </div>
          <div class="divider"></div>
          <div class="stack" id="penaltyQuestBox"></div>
        </div>

        <div class="grid singleCol" style="margin-bottom: 12px">
          <div class="card" style="margin:0">
            <div class="row space">
              <div>
                <div class="cardTitle">Havi Boss (1/hó)</div>
                <div class="hint" id="bossHint">Nehéz hetekre: válassz 1 extra kihívást a hónapban.</div>
              </div>
              <div class="pill" id="bossPill">–</div>
            </div>
            <div class="divider"></div>
            <div class="row" id="bossActions">
              <button class="btn" id="bossOptWalk">+20 perc séta</button>
              <button class="btn ghost" id="bossOptBlock">+1 extra blokk edzés</button>
              <button class="btn ghost" id="bossClear">Reset</button>
            </div>
          </div>

          <div class="card" style="margin:0">
            <div class="row space">
              <div>
                <div class="cardTitle">Heti Dungeon Run</div>
                <div class="hint" id="weeklyHint">–</div>
              </div>
              <div class="pill" id="weeklyPill">–</div>
            </div>
            <div class="progress" style="margin-top:10px">
              <div class="progressLabel"><span>Haladás</span><span id="weeklyProgLabel">–</span></div>
              <div class="bar"><div class="fill" id="weeklyProgFill" style="width:0%"></div></div>
            </div>
            <div class="row" style="margin-top:10px">
              <button class="btn" id="claimWeeklyBtn">Jutalom felvétele</button>
              <div class="pill" id="dailyModPill">Napi mod: –</div>
            </div>
          </div>

          <div class="card" style="margin:0">
            <div class="row space">
              <div>
                <div class="cardTitle">Quick Add</div>
                <div class="hint">Az aktív naphoz gyors hozzáadás.</div>
              </div>
              <div class="pill" id="activeDayPill">Aktív: –</div>
            </div>
            <div class="row" style="margin-top:10px">
              <button class="btn" id="addSteps2k">+2000 lépés</button>
              <button class="btn" id="addSteps5k">+5000 lépés</button>
              <button class="btn ghost" id="addSleep05">+0.5 óra</button>
              <button class="btn ghost" id="addSleep1">+1 óra</button>
            </div>
          </div>

          <div class="card" style="margin:0">
            <div class="row space">
              <div>
                <div class="cardTitle">Havi heatmap</div>
                <div class="hint">Zöld = daily clear · Sárga = részleges · Piros = semmi</div>
              </div>
              <div class="pill" id="heatmapPill">–</div>
            </div>
            <div class="divider"></div>
            <div id="heatmapGrid" class="heatmap"></div>
          </div>
        </div>

        <div id="weekStrip" class="week"></div>
      </div>
    </section>

    <section id="view-schedule" class="view">
      <div class="card">
        <div class="cardTitle">Beosztás</div>
        <div class="divider"></div>
        <div id="scheduleList" class="list"></div>
      </div>
    </section>

    <section id="view-meal" class="view">
      <div class="card">
        <div class="row space">
          <div>
            <div class="cardTitle">Étkezés</div>
            <div class="hint">Menü 2026 adatok.</div>
          </div>
          <div class="pill" id="mealPill">–</div>
        </div>
        <div class="divider"></div>
        <div id="mealToday" class="stack"></div>
        <div class="divider"></div>
        <div id="mealList" class="list"></div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>Adatok: Excel → JSON. Mentés: localStorage.</span>
    <span id="statusMsg" class="status"></span>
  </footer>

  <!-- Excel import helper (SheetJS) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="./app.js"></script>

  <script>
    // PWA-lite
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
